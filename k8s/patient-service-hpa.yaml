---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: patient-service-hpa
  namespace: default
spec:
  # The Deployment that the HPA will monitor and scale
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: patient-service        # Must match the name of your Deployment
  
  # Scaling limits
  minReplicas: 2                 # Keep at least 2 replicas running for high availability
  maxReplicas: 5                 # Maximum number of replicas allowed
  
  # Metrics used for scaling decisions
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization        # Scale based on percentage of requested CPU
        averageUtilization: 70   # Target 70% CPU utilization